(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();const t={EMPTY:0,SAND:1,WATER:2,STONE:3,WOOD:4,FIRE:5,SMOKE:6},E={[t.EMPTY]:[0,0,0,0],[t.SAND]:[226,192,123,255],[t.WATER]:[59,130,246,200],[t.STONE]:[115,115,115,255],[t.WOOD]:[120,53,15,255],[t.FIRE]:[239,68,68,255],[t.SMOKE]:[160,160,160,150]};class T{constructor(e){this.canvas=e,this.x=0,this.y=0,this.isDrawing=!1,this.bindEvents()}bindEvents(){const e=r=>{const i=this.canvas.getBoundingClientRect(),s=this.canvas.width/i.width,n=this.canvas.height/i.height,h=r.touches?r.touches[0].clientX:r.clientX,o=r.touches?r.touches[0].clientY:r.clientY;this.x=Math.floor((h-i.left)*s),this.y=Math.floor((o-i.top)*n)};this.canvas.addEventListener("mousedown",r=>{this.isDrawing=!0,e(r)}),this.canvas.addEventListener("mousemove",r=>{this.isDrawing&&e(r)}),window.addEventListener("mouseup",()=>{this.isDrawing=!1}),this.canvas.addEventListener("touchstart",r=>{r.preventDefault(),this.isDrawing=!0,e(r)},{passive:!1}),this.canvas.addEventListener("touchmove",r=>{r.preventDefault(),this.isDrawing&&e(r)},{passive:!1}),window.addEventListener("touchend",()=>{this.isDrawing=!1})}}class w{constructor(e){this.canvas=e,this.ctx=e.getContext("2d",{alpha:!1}),this.width=e.width,this.height=e.height,this.grid=new Uint8Array(this.width*this.height).fill(t.EMPTY),this.imageData=this.ctx.createImageData(this.width,this.height),this.buf32=new Uint32Array(this.imageData.data.buffer),this.input=new T(e),this.currentTool=t.SAND,this.brushSize=2}setCurrentTool(e){switch(e){case"sand":this.currentTool=t.SAND;break;case"water":this.currentTool=t.WATER;break;case"stone":this.currentTool=t.STONE;break;case"wood":this.currentTool=t.WOOD;break;case"fire":this.currentTool=t.FIRE;break;case"eraser":this.currentTool=t.EMPTY;break;default:this.currentTool=t.SAND}}setBrushSize(e){this.brushSize=e}update(){this.handleInput(),this.updatePhysics()}handleInput(){if(this.input.isDrawing){const e=this.input.x,r=this.input.y,i=this.brushSize;for(let s=-i;s<=i;s++)for(let n=-i;n<=i;n++)if(n*n+s*s<=i*i){const h=e+n,o=r+s;h>=0&&h<this.width&&o>=0&&o<this.height&&Math.random()>.1&&(this.grid[o*this.width+h]=this.currentTool)}}}clear(){this.grid.fill(t.EMPTY)}updatePhysics(){for(let e=this.height-1;e>=0;e--)for(let r=0;r<this.width;r++){const i=e*this.width+r,s=this.grid[i];s===t.EMPTY||s===t.STONE||s===t.WOOD||(s===t.SAND?this.updateSand(r,e,i):s===t.WATER?this.updateWater(r,e,i):s===t.FIRE?this.updateFire(r,e,i):s===t.SMOKE&&this.updateSmoke(r,e,i))}}updateSand(e,r,i){if(r>=this.height-1)return;const s=i+this.width,n=s-1,h=s+1,o=this.grid[s];if(o===t.EMPTY||o===t.WATER||o===t.FIRE)this.grid[s]=t.SAND,this.grid[i]=o===t.WATER?t.WATER:t.EMPTY;else if(e>0){const a=this.grid[n];if(a===t.EMPTY||a===t.WATER||a===t.FIRE)this.grid[n]=t.SAND,this.grid[i]=a===t.WATER?t.WATER:t.EMPTY;else if(e<this.width-1){const l=this.grid[h];(l===t.EMPTY||l===t.WATER||l===t.FIRE)&&(this.grid[h]=t.SAND,this.grid[i]=l===t.WATER?t.WATER:t.EMPTY)}}else if(e<this.width-1){const a=this.grid[h];(a===t.EMPTY||a===t.WATER||a===t.FIRE)&&(this.grid[h]=t.SAND,this.grid[i]=a===t.WATER?t.WATER:t.EMPTY)}}updateWater(e,r,i){if(r>=this.height-1)return;const s=i+this.width,n=this.grid[s];if(n===t.EMPTY||n===t.FIRE){this.grid[s]=t.WATER,this.grid[i]=t.EMPTY;return}const h=Math.random()<.5?1:-1,o=i-1,a=i+1;h===-1?e>0&&(this.grid[o]===t.EMPTY||this.grid[o]===t.FIRE)?(this.grid[o]=t.WATER,this.grid[i]=t.EMPTY):e<this.width-1&&(this.grid[a]===t.EMPTY||this.grid[a]===t.FIRE)&&(this.grid[a]=t.WATER,this.grid[i]=t.EMPTY):e<this.width-1&&(this.grid[a]===t.EMPTY||this.grid[a]===t.FIRE)?(this.grid[a]=t.WATER,this.grid[i]=t.EMPTY):e>0&&(this.grid[o]===t.EMPTY||this.grid[o]===t.FIRE)&&(this.grid[o]=t.WATER,this.grid[i]=t.EMPTY)}updateFire(e,r,i){if(Math.random()<.1){this.grid[i]=Math.random()<.5?t.SMOKE:t.EMPTY;return}const s=i-this.width;if(r>0){const h=Math.random();let o=s;h<.2&&e>0?o=s-1:h>.8&&e<this.width-1&&(o=s+1),this.grid[o]===t.EMPTY?(this.grid[o]=t.FIRE,this.grid[i]=t.EMPTY):this.grid[o]===t.WOOD?Math.random()<.05&&(this.grid[o]=t.FIRE):this.grid[o]===t.WATER&&(this.grid[i]=t.SMOKE)}const n=[i-1,i+1,i-this.width,i+this.width];for(const h of n)h>=0&&h<this.grid.length&&this.grid[h]===t.WOOD&&Math.random()<.02&&(this.grid[h]=t.FIRE)}updateSmoke(e,r,i){if(Math.random()<.1){this.grid[i]=t.EMPTY;return}if(r>0){const s=i-this.width,n=Math.random();let h=s;n<.3&&e>0?h=s-1:n>.7&&e<this.width-1&&(h=s+1),this.grid[h]===t.EMPTY?(this.grid[h]=t.SMOKE,this.grid[i]=t.EMPTY):(this.grid[h]===t.WATER||this.grid[h]===t.STONE)&&Math.random()<.2&&(this.grid[i]=t.EMPTY)}else this.grid[i]=t.EMPTY}draw(){this.buf32.fill(4279045389);for(let e=0;e<this.grid.length;e++){const r=this.grid[e];if(r!==t.EMPTY){const i=E[r];this.buf32[e]=i[3]<<24|i[2]<<16|i[1]<<8|i[0]}}this.ctx.putImageData(this.imageData,0,0)}}const g=document.getElementById("game-canvas");g.width=400;g.height=400;const c=new w(g),u=document.querySelectorAll(".tool");u.forEach(d=>{d.addEventListener("click",()=>{u.forEach(e=>e.classList.remove("active")),d.classList.add("active"),c.setCurrentTool(d.dataset.tool)})});const p=document.getElementById("brush-size");p.addEventListener("input",d=>{c.setBrushSize(parseInt(d.target.value,10))});document.getElementById("clear-btn").addEventListener("click",()=>{c.clear()});function f(){c.update(),c.draw(),requestAnimationFrame(f)}requestAnimationFrame(f);
